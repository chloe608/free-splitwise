{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="group-header">
      <h2>{{ group.name }}</h2>
      <div class="code">Code: <strong>{{ group.code }}</strong></div>
    </div>
    <hr>
    <h3>Expenses</h3>
    {% if expenses %}
      <table class="expenses">
        <thead><tr><th>Date</th><th>Description</th><th>Amount</th><th>By</th></tr></thead>
        <tbody>
          {% for e in expenses %}
            <tr>
              <td>{{ e.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>{{ e.description }}</td>
              <td>${{ '%.2f'|format(e.amount) }}</td>
              <td>{{ user_map.get(e.created_by) if user_map else (e.created_by) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No expenses yet.</p>
    {% endif %}

    <hr>
    <h3>Add expense</h3>
    <form method="post" action="{{ url_for('add_expense', group_id=group.id) }}" id="add-form">
      <label>Description</label>
      <input id="desc" name="description" placeholder="e.g. Pizza">
      <label>Amount</label>
      <input id="amt" name="amount" placeholder="e.g. 23.50" required>
      <button id="add-btn" class="btn" type="submit" disabled>Add</button>
    </form>
    <script>
      (function(){
        const desc = document.getElementById('desc');
        const amt = document.getElementById('amt');
        const btn = document.getElementById('add-btn');
        function validAmount(v){
          if(!v) return false;
          return !Number.isNaN(Number(v));
        }
        function update(){
          const hasDesc = desc && desc.value.trim().length>0;
          const hasAmt = amt && validAmount(amt.value.trim());
          const ok = hasDesc && hasAmt;
          btn.disabled = !ok;
          btn.classList.toggle('btn-active', ok);
        }
        if(desc) desc.addEventListener('input', update);
        if(amt) amt.addEventListener('input', update);
        window.addEventListener('DOMContentLoaded', update);
        update();
      })();
    </script>
  </div>
{% endblock %}
